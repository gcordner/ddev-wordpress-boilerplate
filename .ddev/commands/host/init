#!/bin/bash
## desc: Initialize the project (Composer + WordPress + Adminer)
## usage: ddev init
set -euo pipefail

echo "📦 Installing Composer dev tools..."
ddev composer install

# Ensure Adminer add-on (host-level)
NEED_RESTART=0
if ! ddev add-on list --installed | grep -q 'ddev-adminer'; then
  echo "🧰 Installing Adminer add-on…"
  ddev add-on get ddev/ddev-adminer
  NEED_RESTART=1
else
  echo "🧰 Adminer add-on already present."
fi
if [ "$NEED_RESTART" = "1" ]; then
  echo "🔁 Restarting to wire Adminer routes…"
  ddev restart
fi

echo "🌐 Setting up WordPress..."
# Run the installer script INSIDE the container
ddev exec bash .ddev/scripts/wp-install.sh

echo ""
echo "✅ Project initialized."
echo "🌍 Site URL:"
ddev describe | awk '/https:/{print "   " $1; exit}'

echo ""
echo "🗃  Adminer:"
echo "   Open with: ddev adminer"
echo "   Login → System: MySQL | Server: db | Username: db | Password: db | Database: db"

