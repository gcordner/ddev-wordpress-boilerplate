#!/bin/bash
## desc: Initialize the project (Composer + WordPress + Adminer)
## usage: ddev init
set -euo pipefail

echo "ğŸ“¦ Installing Composer dev tools..."
ddev composer install

# Ensure Adminer add-on (host-level)
NEED_RESTART=0
if ! ddev add-on list --installed | grep -q 'ddev-adminer'; then
  echo "ğŸ§° Installing Adminer add-onâ€¦"
  ddev add-on get ddev/ddev-adminer
  NEED_RESTART=1
else
  echo "ğŸ§° Adminer add-on already present."
fi
if [ "$NEED_RESTART" = "1" ]; then
  echo "ğŸ” Restarting to wire Adminer routesâ€¦"
  ddev restart
fi

echo "ğŸŒ Setting up WordPress..."
# Run the installer script INSIDE the container
ddev exec bash .ddev/scripts/wp-install.sh

echo ""
echo "âœ… Project initialized."
echo "ğŸŒ Site URL:"
ddev describe | awk '/https:/{print "   " $1; exit}'

echo ""
echo "ğŸ—ƒ  Adminer:"
echo "   Open with: ddev adminer"
echo "   Login â†’ System: MySQL | Server: db | Username: db | Password: db | Database: db"

